server.port=8000

# =======================================
# GATEWAY ROUTES
# =======================================
spring.cloud.gateway.preserve-host-header=true

# --- Route for user-service (Public Auth Endpoints) ---
spring.cloud.gateway.routes[0].id=user-service-auth
spring.cloud.gateway.routes[0].uri=http://user-service:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/auth/**

# --- Route for user-service (Protected User Endpoints) ---
spring.cloud.gateway.routes[1].id=user-service-users
spring.cloud.gateway.routes[1].uri=http://user-service:8081
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/users/**
spring.cloud.gateway.routes[1].filters[0]=AuthenticationFilter

# --- Route for portfolio-service (Protected) ---
spring.cloud.gateway.routes[2].id=portfolio-service
spring.cloud.gateway.routes[2].uri=http://portfolio-service:8082
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/portfolios/**
spring.cloud.gateway.routes[2].filters[0]=AuthenticationFilter

# --- NEW: Route for strategy-service (ADD auth filter) ---
spring.cloud.gateway.routes[3].id=strategy-service
spring.cloud.gateway.routes[3].uri=http://strategy-service:8083
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/strategies/**
spring.cloud.gateway.routes[3].filters[0]=AuthenticationFilter

# --- NEW: Route for market-data-service (ADD auth filter) ---
spring.cloud.gateway.routes[4].id=market-data-service
spring.cloud.gateway.routes[4].uri=http://market-data-service:8084
# Note: market-data-service is HTTP-only now (websocket handled by notification-service)
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/market-data/**
spring.cloud.gateway.routes[4].filters[0]=AuthenticationFilter

# --- NEW: Route for backtesting-service (ADD auth filter) ---
spring.cloud.gateway.routes[5].id=backtesting-service
spring.cloud.gateway.routes[5].uri=http://backtesting-service:8085
spring.cloud.gateway.routes[5].predicates[0]=Path=/api/backtest/**
spring.cloud.gateway.routes[5].filters[0]=AuthenticationFilter

# --- Route for the monolith (Catch-all for remaining /api/** routes) ---
spring.cloud.gateway.routes[6].id=tradewise-api-monolith
spring.cloud.gateway.routes[6].uri=http://tradewise-api:8080
spring.cloud.gateway.routes[6].predicates[0]=Path=/api/**
spring.cloud.gateway.routes[6].filters[0]=AuthenticationFilter

# --- NEW: Route for notification-service (WebSocket & Notification API) ---
spring.cloud.gateway.routes[7].id=notification-service-ws
spring.cloud.gateway.routes[7].uri=ws://notification-service:8086
spring.cloud.gateway.routes[7].predicates[0]=Path=/ws/**
#spring.cloud.gateway.routes[7].filters[0]=RemoveRequestHeader=Sec-WebSocket-Extensions

spring.cloud.gateway.routes[8].id=notification-service-api
spring.cloud.gateway.routes[8].uri=http://notification-service:8086
spring.cloud.gateway.routes[8].predicates[0]=Path=/api/notifications/**
spring.cloud.gateway.routes[8].filters[0]=AuthenticationFilter

# ============================
# GLOBAL CORS FOR REST ONLY
# ============================
spring.cloud.gateway.globalcors.add-to-simple-url-handler-mapping=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=http://localhost:3000
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].exposed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=true

# Avoid duplicate CORS headers
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

# =======================================
# JWT (JSON WEB TOKEN)
# =======================================
tradewise.app.jwtSecret=EaW7nZJ3p6v9y$B&E)H@McQfTjWnZr4u7x!A%D*G-KaPdSgUkXp2s5v8y/B?E(H+
tradewise.app.jwtExpirationMs=86400000

# =======================================
# SECURITY CONFIG
# =======================================
# Make security stateless (no sessions)
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=
